<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Believe - Admin Dashboard</title>
  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="style1.css"/>
  
</head>
<body>
  <!-- Simple admin top bar -->
  <header class="top-bar-admin">
    <a href="index.html" class="brand">Believe</a>
    <div class="right">
      <span>Role: Admin (demo)</span>
      <button class="logout-btn" id="adminLogoutBtn">Logout</button>
    </div>
  </header>

  <main class="admin-wrap">
    <section class="admin-header">
      <h2>Admin Dashboard – NGO Approvals</h2>
      <p>Review newly registered NGOs and approve them before they can submit projects or receive donations.</p>
    </section>

    <!-- Summary cards -->
    <section class="admin-summary">
      <div class="admin-card">
        <h3>Total NGOs</h3>
        <strong id="totalNgos">0</strong>
      </div>
      <div class="admin-card">
        <h3>Approved NGOs</h3>
        <strong id="approvedNgos">0</strong>
      </div>
      <div class="admin-card">
        <h3>Pending NGOs</h3>
        <strong id="pendingNgos">0</strong>
      </div>
    </section>

    <!-- NGO list table -->
    <section>
      <h3>NGO Accounts</h3>
      <table class="admin-table">
        <thead>
          <tr>
            <th>NGO Name</th>
            <th>Email</th>
            <th>Status</th>
            <th>Actions (demo)</th>
          </tr>
        </thead>
        <tbody id="ngoTableBody">
          <tr>
            <td colspan="4">No NGO accounts found.</td>
          </tr>
        </tbody>
      </table>
      <p style="font-size:13px;color:#666;margin-top:8px;">
        Note: This is a frontend-only demo using <code>localStorage["demoUsers"]</code>. In the PHP/MySQL phase, this screen will read from the real database.
      </p>
    </section>


  
<hr style="margin:25px 0;">

<h3>Pending Project Submissions</h3>
<table class="admin-table">
  <thead>
    <tr>
      <th>NGO</th>
      <th>Project Title</th>
      <th>Goal (BDT)</th>
      <th>Description</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="projectReqBody">
    <tr><td colspan="6">Loading...</td></tr>
  </tbody>
</table>





  </main>

  <script>
    // Simple "logout" for demo: clear session and go back to login
    document.getElementById('adminLogoutBtn').onclick = () => {
      localStorage.removeItem('demoSession');
      window.location.href = 'login.html';
    };

    function loadNgoListForAdmin() {
      const tbody = document.getElementById('ngoTableBody');

      let users = [];
      try {
        users = JSON.parse(localStorage.getItem('demoUsers') || '[]');
      } catch (e) {
        users = [];
      }

      // Filter NGOs only
      const ngos = users.filter(u => u.role === 'ngo');

      // Summary counts
      const total = ngos.length;
      const approved = ngos.filter(u => (u.status || 'pending') === 'approved').length;
      const pending = ngos.filter(u => (u.status || 'pending') === 'pending').length;

      document.getElementById('totalNgos').textContent = total;
      document.getElementById('approvedNgos').textContent = approved;
      document.getElementById('pendingNgos').textContent = pending;

      // Table
      tbody.innerHTML = '';

      if (ngos.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 4;
        td.textContent = 'No NGO accounts found yet. Ask an NGO to sign up from the Login page.';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      ngos.forEach((ngo, index) => {
        const tr = document.createElement('tr');

        const nameTd = document.createElement('td');
        nameTd.textContent = ngo.name || '(no name)';

        const emailTd = document.createElement('td');
        emailTd.textContent = ngo.email || '';

        const statusTd = document.createElement('td');
        const statusSpan = document.createElement('span');
        const status = ngo.status || 'pending';

        statusSpan.classList.add('badge');
        if (status === 'approved') {
          statusSpan.classList.add('badge-approved');
          statusSpan.textContent = 'Approved';
        } else if (status === 'rejected') {
          statusSpan.classList.add('badge-rejected');
          statusSpan.textContent = 'Rejected';
        } else {
          statusSpan.classList.add('badge-pending');
          statusSpan.textContent = 'Pending';
        }
        statusTd.appendChild(statusSpan);

        const actionsTd = document.createElement('td');

        // Approve button
        const approveBtn = document.createElement('button');
        approveBtn.textContent = 'Approve';
        approveBtn.className = 'btn-small';
        approveBtn.disabled = (status === 'approved');
        approveBtn.onclick = () => {
          updateNgoStatus(ngo.email, 'approved');
        };
        actionsTd.appendChild(approveBtn);

        

        // Optional reject button (demo only)
        const rejectBtn = document.createElement('button');
        rejectBtn.textContent = 'Reject';
        rejectBtn.className = 'btn-small secondary';
        rejectBtn.style.marginLeft = '6px';
        rejectBtn.onclick = () => {
          updateNgoStatus(ngo.email, 'rejected');
        };
        actionsTd.appendChild(rejectBtn);

        tr.appendChild(nameTd);
        tr.appendChild(emailTd);
        tr.appendChild(statusTd);
        tr.appendChild(actionsTd);

        tbody.appendChild(tr);
      });
    }

    function updateNgoStatus(email, newStatus) {
      let users = [];
      try {
        users = JSON.parse(localStorage.getItem('demoUsers') || '[]');
      } catch (e) {
        users = [];
      }

      const idx = users.findIndex(u => u.email === email && u.role === 'ngo');
      if (idx === -1) return;

      users[idx].status = newStatus;
      localStorage.setItem('demoUsers', JSON.stringify(users));

      alert('NGO "' + (users[idx].name || email) + '" status updated to: ' + newStatus.toUpperCase());
      loadNgoListForAdmin();
    }

    // Initial load
    loadNgoListForAdmin();


function loadProjectRequests() {
  const tbody = document.getElementById('projectReqBody');
  let requests = JSON.parse(localStorage.getItem('projectRequests') || '[]');

  tbody.innerHTML = '';

  if (requests.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6">No project requests found.</td></tr>';
    return;
  }

  requests.forEach((req, index) => {
    const tr = document.createElement('tr');

    tr.innerHTML = `
      <td>${req.ngoName}</td>
      <td>${req.title}</td>
      <td>৳${req.goal.toLocaleString()}</td>
      <td>${req.desc}</td>
      <td>${req.status}</td>
      <td>
        <button class="btn-small" onclick="approveProject(${index})">Approve</button>
        <button class="btn-small secondary" onclick="rejectProject(${index})" style="margin-left:6px;">Reject</button>
      </td>
    `;

    tbody.appendChild(tr);
  });
}

function approveProject(index) {
  let requests = JSON.parse(localStorage.getItem('projectRequests') || '[]');
  let approvedProjects = JSON.parse(localStorage.getItem('approvedProjects') || '[]');

  let proj = requests[index];
  proj.status = "approved";

 approvedProjects.push({
  ngoId: proj.ngoId,          // ✅ IMPORTANT (email)
  ngoName: proj.ngoName,      // display name
  title: proj.title,
  desc: proj.desc,
  goal: proj.goal,
  raised: proj.raised || 0,
  date: proj.date
});


  // remove from requests
  requests.splice(index, 1);

  localStorage.setItem('projectRequests', JSON.stringify(requests));
  localStorage.setItem('approvedProjects', JSON.stringify(approvedProjects));

  alert("Project approved and published!");
  loadProjectRequests();
}

function rejectProject(index) {
  let requests = JSON.parse(localStorage.getItem('projectRequests') || '[]');
  requests[index].status = "rejected";

  localStorage.setItem('projectRequests', JSON.stringify(requests));
  alert("Project rejected.");
  loadProjectRequests();
}

loadProjectRequests();


  </script>
</body>
</html>
